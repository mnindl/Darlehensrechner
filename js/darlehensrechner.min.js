if(!window.DARLEHENSRECHNER){var DARLEHENSRECHNER={}}DARLEHENSRECHNER.loan_computer=(function(){var d;var c;var m=true;var g=false;var l=[];var n;var h=0;function o(){c=new finanzierungsvorhaben();v();i();t();s()}function i(){var w={min:300,max:2500,create:function(z,y){var A=$(".monthly_rate_slider .ui-slider-handle").position();$("<div>").attr("id","tip_monthly").text("300").css({left:A.left-32}).appendTo(".slider_monthly");k()},slide:function(z,y){var A=$(".monthly_rate_slider .ui-slider-handle").position();$("#tip_monthly").text(j(y.value,false)).css({left:A.left-32});k()},change:function(z,y){var A=$(".monthly_rate_slider .ui-slider-handle").position();$("#tip_monthly").text(j(y.value,false)).css({left:A.left-32});k()}};var x={min:1000,max:100000,create:function(z,y){var A=$(".own_capital_slider .ui-slider-handle").position();$("<div>").attr("id","tip_capital").text("1.000").css({left:A.left-32}).appendTo(".slider_capital");k()},slide:function(z,y){var A=$(".own_capital_slider .ui-slider-handle").position();$("#tip_capital").text(j(y.value,false)).css({left:A.left-32});k()},change:function(z,y){var A=$(".own_capital_slider .ui-slider-handle").position();$("#tip_capital").text(j(y.value,false)).css({left:A.left-32});k()}};if(m){$(".slider_monthly").slider(w);$(".slider_capital").slider(x)}}function t(){$('input[type="radio"]').change(function(w){k()});$('input[type="text"]').change(function(x){var w=$(this).val()+"";console.log(w);w=w.replace(/\,/,".");console.log(w);w=parseFloat(w);console.log(w);if(isNaN(w)){if($(this).attr("id")==="interest_rate"){$(this).val("4")}else{if($(this).attr("id")==="clearance_val"){c.tilgung=w;$(this).val("1")}}}else{if($(this).attr("id")==="clearance_val"){c.tilgung=w;$(".extra_conf #clearance_val").val(f(c.tilgung))}}if(w>10){$(this).val("10")}else{if(w<1){$(this).val("1")}}k()});$("input#interest_rate").keypress(function(){g=true});$("#use_market_values").click(function(){if($("#use_market_values").attr("checked")){g=false}else{g=true}k()});$(".loan_compute_result .other_scout_user").click(function(){l=[];q()});$(".finance_other_scout_users .left button").click(function(){$(".finance_other_scout_users").hide();$(".loan_compute_box").show();$(".scout_datas_list_hidden").html("")});$(".item_detail_button_link").live("click",function(){$(".finance_other_scout_users").hide();$(".announcement_item").show();p(this)});$(".announcement_item .left button").click(function(){$(".announcement_item").hide();$(".finance_other_scout_users").show()})}function s(){$(".info").tooltip({delay:120,position:"top left",offset:[10,-10]});$(".info2").tooltip({delay:120,position:"bottom center",offset:[20,-3]})}function v(){m=false;var w;$.ajax({type:"GET",url:"/rest/interestRateTrendReport",dataType:"xml",async:false,beforeSend:function(){$(".loan_compute .loan_compute_box").hide();$(".loan_compute .ajax_loader").show()},success:function(x){d=$(x);m=true;$(".loan_compute .ajax_loader").hide();$(".loan_compute .loan_compute_box").show()},error:function(z,x,y){$(".loan_compute .ajax_loader").hide();$(".loan_compute .loan_compute_box").html('<p class="error">Der Darlehensrechner ist momentan ausser Betrieb.</p>').show()}});return w}function k(){var C;var B=true;if($(".extra_conf #use_market_values").attr("checked")){var A=d.find("loan-term");A.each(function(D,E){var F=$(E).text();switch(F){case"5":c.effektivzins[0]=$(E).parent().find("effective-interest-rate").text();break;case"10":c.effektivzins[1]=$(E).parent().find("effective-interest-rate").text();break;case"15":c.effektivzins[2]=$(E).parent().find("effective-interest-rate").text();break;case"20":c.effektivzins[3]=$(E).parent().find("effective-interest-rate").text();break}});$("input#interest_rate").attr("disabled","disabled")}else{c.effektivzins=c.effektivzins_back;$("input#interest_rate").removeAttr("disabled")}var y=$("#tip_monthly").html()+"";y=y.replace(/\./,"");c.rate=parseInt(y,10);var x=$("#tip_capital").html()+"";x=x.replace(/\./,"");c.eigenkapital=parseInt(x,10);c.sollzinsbindung=parseInt($("input:radio[name=debit_interest_binding]:checked").val(),10);if(!(isNaN(parseFloat($("#clearance_val").val())))){var z=$("#clearance_val").val();z=z.replace(/,/,".");c.tilgung=parseFloat(z)}var w=$("#interest_rate").val();w=w.replace(/,/,".");w=parseFloat(w);if(((!(isNaN(w))&&!(B))||g)){switch(c.sollzinsbindung){case 5:c.effektivzins[0]=w;C=w;break;case 10:c.effektivzins[1]=w;C=w;break;case 15:c.effektivzins[2]=w;C=w;break;case 20:c.effektivzins[3]=w;C=w;break}}else{B=false;switch(c.sollzinsbindung){case 5:C=c.effektivzins[0];break;case 10:C=c.effektivzins[1];break;case 15:C=c.effektivzins[2];break;case 20:C=c.effektivzins[3];break}}c.calculate();$(".loan_compute_result .sum p").html(j(c.kaufpreis,true));$(".loan_compute_result #remain_dept").html(j(c.restschuld,true));$(".loan_compute_result .years").html(c.sollzinsbindung);$(".loan_compute_result #clearance").html(f(c.tilgung));$(".loan_compute_result #ann_percent_rate").html(f(C));$(".extra_conf #interest_rate").val(f(C));B=true;$(".loan_compute_result #debit_interest").html(f(c.nominalzins.toFixed(2)))}function j(y,w){var x=parseInt(y*100,10);x=x/100;x=x.toFixed();x=x.replace(/\./,",");while(x.match(/^(\d+)(\d{3}\b)/)){x=x.replace(/^(\d+)(\d{3}\b)/,RegExp.$1+"."+RegExp.$2)}if(w){return x+" &#128;"}else{return x}}function f(x){var w=x+"";w=w.replace(/\./,",");return w}function q(){$(".scout_datas_list").empty();h=0;$.ajax({type:"GET",url:"/rest/ausschreibungen?darlehenshoehemin="+Math.round(c.darlehen*0.9)+"&darlehenshoehemax="+Math.round(c.darlehen*1.2)+"&ratemin="+Math.round(c.rate*0.9)+"&ratemax="+Math.round(c.rate*1.2),dataType:"xml",async:true,beforeSend:function(){$(".loan_compute .loan_compute_box").hide();$(".loan_compute .ajax_loader").show()},success:function(w){u(w)},error:function(y,w,x){$(".loan_compute .ajax_loader").hide();$(".loan_compute .finance_other_scout_users").html('<p class="error">Der Darlehensrechner ist momentan ausser Betrieb.</p>').show()}})}function u(w){n=$(w).find("ausschreibungRef").length;if(n>0){$(".finanz_datas .info_layer").hide();$(".scout_datas_list_hidden").html("");$(w).find("ausschreibungRef").each(function(y,z){if(y<20){var x=$(z).attr("href").replace(/http:\/\/www.meine-baufinanzierung.de/g,"");$.ajax({type:"GET",url:x,dataType:"xml",async:true,success:function(A){e(y,A)},error:function(C,A,B){$(".loan_compute .ajax_loader").hide();$(".loan_compute .finance_other_scout_users").html('<p class="error">Der Darlehensrechner ist momentan ausser Betrieb.</p>').show()}})}});$(".loan_compute .ajax_loader").hide();$(".loan_compute .finance_other_scout_users").show()}else{$(".finanz_datas .info_layer .sum").html(j(c.kaufpreis,true));$(".finanz_datas .info_layer .own_capital").html(j(c.eigenkapital,true));$(".loan_compute .ajax_loader").hide();$(".finanz_datas .info_layer").show();$(".loan_compute .finance_other_scout_users").show();$(".scout_datas_list_hidden").html("")}}function e(C,y){var G=$(y);var N=G.find("immobilienart").text().toLowerCase();var D=G.find("ort").text().toLowerCase();var w=j(G.find("darlehenshoehe").text(),true);var M=j(G.find("rate").text(),true);var J=G.find("zinsbindung").text();var I=G.find("effektivzins").text().slice(0,4);var L;if(G.find("topBerater").size()>0){L=G.find("topBerater").attr("href")}else{L=G.find("beraterRef").attr("href")}var B;var E;if(L){var A=L.replace(/http:\/\/www.meine-baufinanzierung.de/g,"");$.ajax({type:"GET",url:A,dataType:"xml",async:false,success:function(O){E=$(O).find("logoThumbnailUrl").text();B=$(O)},error:function(Q,O,P){alert("Der Darlehensrechner ist momentan ausser Betrieb.")}})}var H=$('<img src="'+(E!==undefined?E:"images/berater-default.gif")+'" alt="itemImage" />');var F='<div class="item_list_data"><h2><i>'+N+"</i> in <i>"+D+"</i></h2><span>Darlehensh&#246;he: "+w+", "+M+" monatliche Rate, "+J+" Jahre Sollzinsbindung, "+f(I)+" &#37; eff. Jahreszins</span></div>";var K=$(F);var z=$('<div class="item_detail_button"><a class="item_detail_button_link" id="detail_'+C+'"><span>Details</span></a></div>');var x=$('<li class="result"></li>').prepend(z).prepend(K).prepend(H);$(".scout_datas_list_hidden").append(x);b(C,G,B)}function b(x,y,z){var A=y.find("finanzierungsobjekt").text().toLowerCase();if(A==="kauf_neubau"){A="Kauf Neubauobjekt"}else{if(A==="kauf_modernisierung"){A="Kauf und Modernisierung"}}var w={finanzierungsobjekt:A,immobilienart:y.find("immobilienart").text().toLowerCase(),ort:y.find("ort").text().toLowerCase(),immobiliennutzung:y.find("immobiliennutzung").text().toLowerCase(),gesamtkosten:j(y.find("gesamtkosten").text(),true),darlehenshoehe:j(y.find("darlehenshoehe").text(),true),eigenkapital:j(y.find("eigenkapital").text(),true),zinsbindung:y.find("zinsbindung").text(),tilgungsrate:y.find("tilgungsrate").text().slice(0,4),logourl:z.find("logoUrl").text(),rate:j(y.find("rate").text(),true),effektivzins:y.find("effektivzins").text().slice(0,4),nominalzins:y.find("nominalzins").text().slice(0,4),firmenname:z.find("firmenname").text(),salutation:z.find("salutation").text(),firstname:z.find("firstName").text(),lastname:z.find("lastName").text(),homepage:z.find("homepage").text(),telefonnummer:z.find("telefonnummer").text()};l[x]=w;h++;if(h===n){a()}}function p(w){var x=l[parseInt($(w).attr("id").slice(7),10)];$(".announcement_item .finanzierungsobjekt").html(x.finanzierungsobjekt);$(".announcement_item .immobilienart").html(x.immobilienart);$(".announcement_item .ort").html(x.ort);$(".announcement_item .immobiliennutzung").html(x.immobiliennutzung);$(".announcement_item .gesamtkosten").html(x.gesamtkosten);$(".announcement_item .darlehenshoehe").html(x.darlehenshoehe);$(".announcement_item .eigenkapital").html(x.eigenkapital);$(".announcement_item .zinsbindung").html(x.zinsbindung+" Jahre");$(".announcement_item .tilgungsrate").html(f(x.tilgungsrate)+" &#37;");$(".announcement_item .logourl").attr("src",x.logourl);$(".announcement_item .rate").html(x.rate);$(".announcement_item .effektivzins").html(f(x.effektivzins)+" &#37;");$(".announcement_item .nominalzins").html(f(x.nominalzins)+" &#37;");$(".announcement_item #firmenname").html(x.firmenname);$(".announcement_item .salutation").html(x.salutation);$(".announcement_item .firstname").html(x.firstname);$(".announcement_item .lastname").html(x.lastname);$(".announcement_item #homepage a").attr("href",x.homepage).html(x.homepage);$(".announcement_item #telefonnummer").html("Tel.: "+x.telefonnummer)}function a(){var w=$(".scout_datas_list_hidden li.result").length;$("#pagination").pagination(w,{callback:r,items_per_page:4})}function r(x,B){$(".scout_datas_list").empty();var z;x=x+1;var w=(x*4)-3;var A=x*4;for(w;w<=A;w++){z=$(".scout_datas_list_hidden li.result:eq("+(w-1)+")").clone();$(".scout_datas_list").append(z)}return false}return{init:function(){return o()}}}());if(window.jQuery){DARLEHENSRECHNER.loan_computer.init()};